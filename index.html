<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Bazaar 1.3 FIXED</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #ffffff;
      color: #333;
    }
    .container {
      display: flex;
      flex-direction: column;
    }
    .header {
      background-color: #ffffff;
      padding: 40px 20px;
      display: flex;
      align-items: center;
      border-bottom: none;
      box-shadow: none;
    }
    .logo {
      font-family: 'Bangers', Impact, Charcoal, sans-serif;
      font-size: 120px;
      color: #d92626;
      letter-spacing: 2px;
      text-shadow: 3px 3px #000000;
      flex: 1;
    }
    .content { display: block; }
    /* Sidebar removed in favor of header CTAs */
    .right-sidebar { display: none !important; }
    #cartItems {
      list-style: none;
      padding-left: 0;
    }
    #cartItems li {
      margin-bottom: 8px;
    }
    #cartItems button {
      margin-left: 8px;
    }
    #checkoutBtn {
      margin-top: 8px;
    }
    .auth { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
    .auth-row { display: flex; align-items: center; gap: 12px; }
    #loginForm {
      display: none;
      margin-top: 8px;
    }
    #loginForm input {
      margin-bottom: 4px;
    }
    .condition-buttons {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      background: rgba(0, 0, 0, 0.3);
      padding: 12px 0;
      box-sizing: border-box;
    }
    /* Email capture modal */
    .cb-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .cb-modal {
      background: #fff;
      width: 90vw;
      max-width: 960px;
      border-radius: 14px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.35);
      overflow: hidden;
    }
    .cb-modal-grid {
      display: flex;
      min-height: 520px;
    }
    .cb-modal-img {
      flex: 1 1 55%;
      background: #0b1a2b;
      min-height: 520px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    /* Modal card stack */
    .cb-card-frame {
      position: relative;
      width: 92%;
      max-width: 520px;
      aspect-ratio: 512 / 716;
    }
    .cb-card-frame::before {
      content: '';
      display: block;
      padding-top: calc(716 / 512 * 100%);
    }
    .cb-card-stack {
      position: absolute;
      inset: 0;
    }
    .cb-card-stack .cb-variant-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.4);
      backface-visibility: hidden;
    }
    .cb-card-stack .cb-bottom { transform: translate(-12px, -12px) rotate(-4deg) scale(0.98); z-index: 1; filter: brightness(0.92); }
    .cb-card-stack .cb-mid    { transform: translate(10px, -6px) rotate(2deg) scale(0.99);  z-index: 2; filter: brightness(0.96); }
    .cb-card-stack .cb-top    { transform: translate(0px, 0px) rotate(0deg) scale(1.0);     z-index: 3; }
    .cb-modal-body {
      flex: 1 1 45%;
      background: linear-gradient(180deg, #0b1a2b 0%, #0b1a2b 60%, #142d4c 100%);
      color: #fff;
      padding: 32px 28px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: stretch;
      text-align: left;
    }
    .cb-modal h3 {
      margin: 0 0 6px;
      font-size: 28px;
      letter-spacing: 0.5px;
    }
    .cb-modal .cb-brand {
      font-family: 'Bangers', Impact, Charcoal, sans-serif;
      font-size: 40px;
      color: #ff6b6b;
      text-shadow: 2px 2px #000;
      margin-bottom: 8px;
    }
    .cb-modal p {
      margin: 0 0 16px;
      font-size: 16px;
      color: #e6e6e6;
    }
    .cb-modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }
    .cb-input {
      width: 100%;
      padding: 14px 14px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-radius: 10px;
      font-size: 18px;
      box-sizing: border-box;
      outline: none;
    }
    .cb-input::placeholder { color: rgba(255,255,255,0.8); }
    .cb-btn-primary {
      background: linear-gradient(45deg, #d92626, #ff7e5f);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 800;
      letter-spacing: 0.4px;
      font-size: 18px;
      cursor: pointer;
    }
    .cb-btn-secondary {
      background: transparent;
      color: #e6e6e6;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .cb-modal .cb-footnote {
      margin-top: 10px;
      font-size: 12px;
      color: #cfd8dc;
      opacity: 0.9;
    }
    /* Daily Spin Modal */
    .cb-wheel-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: none; align-items: center; justify-content: center; z-index: 1200; }
    .cb-wheel-modal { background: #0b1a2b; color: #fff; width: 92vw; max-width: 980px; border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.45); overflow: hidden; }
    .cb-wheel-grid { display: flex; flex-wrap: wrap; }
    .cb-wheel-left { flex: 1 1 50%; min-width: 320px; padding: 28px; display:flex; align-items:center; justify-content:center; }
    .cb-wheel-right { flex: 1 1 50%; min-width: 320px; padding: 28px; background: linear-gradient(180deg,#0b1a2b,#142d4c); display:flex; flex-direction:column; justify-content:center; }
    .cb-wheel-brand { font-family: 'Bangers', Impact, Charcoal, sans-serif; font-size: 44px; color: #ff6b6b; text-shadow: 2px 2px #000; margin-bottom: 8px; }
    .cb-wheel-title { font-size: 26px; margin: 6px 0 12px; }
    .cb-wheel-legend { font-size: 14px; color: #dfe6ee; margin-bottom: 14px; }
    .cb-wheel-controls { display:flex; gap:10px; margin-top: 10px; }
    .cb-wheel-container { position: relative; width: 320px; height: 320px; }
    .cb-wheel { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #fff; box-shadow: 0 12px 30px rgba(0,0,0,0.5); transition: transform 4s cubic-bezier(.17,.67,.26,1.2); background: conic-gradient(#ff6b6b 0 90deg, #42a5f5 90deg 180deg, #66bb6a 180deg 270deg, #ffd54f 270deg 360deg); }
    .cb-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 12px solid transparent; border-right: 12px solid transparent; border-bottom: 18px solid #fff; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4)); }
    .cb-result { margin-top: 10px; font-size: 16px; color: #a5d6a7; min-height: 24px; }
    @media (max-width: 768px) { .cb-wheel-left { padding: 20px; } .cb-wheel-container { width: 260px; height: 260px; } .cb-wheel-brand { font-size: 36px; } .cb-wheel-title { font-size: 22px; } }
    @media (max-width: 768px) {
      .cb-modal { width: 94vw; }
      .cb-modal-grid { flex-direction: column; min-height: 0; }
      .cb-modal-img { min-height: 260px; }
      .cb-modal-body { padding: 20px; }
      .cb-modal .cb-brand { font-size: 34px; }
      .cb-modal h3 { font-size: 24px; }
    }
    .btn-cta { background: linear-gradient(45deg, #d92626, #ff7e5f); color: #fff; border: none; padding: 14px 22px; border-radius: 14px; font-size: 20px; font-weight: 800; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .btn-cta:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.35); }
    .btn-ghost { background: #fff; color: #d92626; border: 2px solid #d92626; padding: 14px 22px; border-radius: 14px; font-size: 20px; font-weight: 800; cursor: pointer; }
    #loginBtn.expanded { padding: 18px 28px; font-size: 22px; border-radius: 16px; }
    .badge { background: #000; color: #fff; border-radius: 999px; padding: 2px 8px; font-size: 12px; margin-left: 8px; }
    .small-note { font-size: 14px; font-weight: 700; opacity: 0.9; }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 512px);
      gap: 40px;
      padding: 20px 40px 60px 40px;
      justify-content: start;
      background-color: #ffffff;
      width: 100%;
    }
    .card {
      position: relative;
      width: 512px;
      height: 716px;
      overflow: visible;
      margin-bottom: 20px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 24px;
    }
    .card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }
    .card-stack {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.3s ease-in-out;
      perspective: 1000px;
    }
    .variant-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.3s ease-in-out;
      object-fit: cover;
      cursor: pointer;
      z-index: 1;
      backface-visibility: hidden;
      border-radius: 24px;
    }
    .variant-image.active {
      z-index: 5;
      pointer-events: none;
    }
    /* related-cards styles removed (tabled) */
    .card:hover .card-stack {
      transform: translateY(-5px) rotate(-1deg);
    }
    .variant-image.flipping {
      transform: rotateY(90deg);
    }
    .variant-image[data-condition="VG"],
    .variant-image[data-condition="EX"],
    .variant-image[data-condition="G"] {
      filter: brightness(0.85) contrast(0.95);
    }
    .condition-buttons button,
    .add-cart-btn {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      border: 1px solid #fff;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }
    .condition-buttons button:hover,
    .add-cart-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }
    .condition-buttons button.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    /* Celebration overlays */
    .celebrate-banner {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 800;
      letter-spacing: .4px;
      z-index: 999;
      opacity: 0;
      transition: opacity .25s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    }
    .celebrate-banner.show { opacity: 1; }
    .lastcopy-badge {
      position: absolute;
      right: 12px;
      bottom: 12px;
      background: #d92626;
      color: #fff;
      padding: 6px 10px;
      font-size: 14px;
      font-weight: 900;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 20;
      animation: pulse 1.2s ease-in-out infinite;
      display: none;
    }
    .lastcopy-badge.show { display: block; }
    @keyframes pulse {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.06); }
    }
    .variant-image.sold-out { filter: grayscale(0.9) brightness(0.7); }

    /* Card meta (testimonials) */
    .card-meta {
      margin-top: 8px;
      color: #444;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 4px;
    }
    .card-meta .testimonial-user { font-weight: 600; }
    .card-meta .testimonial-sold { color: #666; }

    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
        gap: 20px;
        padding: 16px;
        justify-content: stretch;
        width: 100%;
      }
      .card {
        width: 100%;
        max-width: 512px;
        height: auto;
        aspect-ratio: 512 / 716;
        margin: 0 auto 20px;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: center;
        padding: 20px 10px;
      }
      .logo {
        font-size: 60px;
        margin-bottom: 10px;
        text-align: center;
      }
      .content { display: block; }
      .grid {
        padding: 12px;
        width: 100%;
      }
      /* Fallback aspect ratio for iOS Safari and older browsers */
      .card {
        position: relative;
        width: 100%;
        max-width: 512px;
        margin: 0 auto 20px;
      }
      .card::before {
        content: '';
        display: block;
        padding-top: calc(716 / 512 * 100%);
      }
      .card-stack {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
      .condition-buttons button,
      .add-cart-btn {
        font-size: 16px;
        padding: 8px 10px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">CARD BAZAAR</div>
      <div class="auth">
        <div class="auth-row">
          <button id="headerCartBtn" class="btn-ghost" aria-haspopup="true" aria-expanded="false">
            <span>My Cart</span>
            <span id="headerCartTotal" class="small-note">$0.00</span>
            <span id="headerStoreCredit" class="small-note" style="color:#ff8a80; margin-left:6px;">+$0.00 credit</span>
            <span id="headerCartCount" class="badge">0</span>
          </button>
          <span id="userStatus"></span>
          <button id="loginBtn" class="btn-cta">Log In</button>
        </div>
        <div class="auth-row" style="flex-direction: column; align-items: flex-end; gap: 8px;">
          <button id="sellHeaderBtn" class="btn-cta" style="width: 260px;">Sell Cards</button>
          <button id="binderHeaderBtn" class="btn-cta" style="display:none; width: 260px;">My Binder</button>
        </div>
        <div id="loginForm">
          <input type="email" id="loginEmail" placeholder="Email">
          <input type="password" id="loginPassword" placeholder="Password">
          <button id="loginSubmit" type="button">Submit</button>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="grid" id="cardGrid">
        <!-- Cards will be populated here -->
      </div>
    </div>
  </div>
  <!-- Header Cart Popup -->
  <div id="headerCartPopup" style="display:none; position:fixed; top:96px; right:24px; background:#fff; color:#333; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.25); width:320px; padding:12px; z-index:1500;">
    <ul id="cartItems" style="list-style:none; padding-left:0; max-height:240px; overflow:auto;"></ul>
    <div id="cartTotal" style="font-weight:800; margin-top:8px;"></div>
    <button id="checkoutBtn" class="btn-cta" style="width:100%; margin-top:8px; display:none;">Proceed to Checkout</button>
  </div>
  <!-- Binder & Sell popups -->
  <div id="binderInfoPopup" style="display:none; position:fixed; top:96px; right:24px; background:#fff; color:#333; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.25); width:420px; padding:16px; z-index:1400;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
      <div style="font-weight:800; font-size:18px;">My Binder</div>
      <div id="binderSummary" style="font-weight:700; font-size:14px;"></div>
    </div>
    <div id="binderListEmpty" style="font-size:14px; color:#555;">Your binder is empty. Check out while logged in to add purchases here.</div>
    <div id="binderGrid" class="binder-grid" style="display:grid; grid-template-columns: repeat(3, 120px); gap: 12px; max-height: 300px; overflow:auto;"></div>
  </div>
  <style>
    .binder-item { position: relative; width: 120px; }
    .binder-item img { width: 100%; height: 168px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .binder-item .meta { font-size: 12px; margin-top: 4px; display: flex; justify-content: space-between; }
    .binder-item .actions { display:flex; gap:4px; margin-top:4px; }
    .binder-item[draggable="true"] { cursor: grab; }
    /* High-res image overlay */
    .img-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index: 2000; }
    .img-modal { position: relative; max-width: 92vw; max-height: 92vh; }
    .img-modal img { max-width: 92vw; max-height: 92vh; border-radius: 12px; box-shadow: 0 12px 32px rgba(0,0,0,0.5); }
    .img-close { position:absolute; top:-12px; right:-12px; background:#fff; color:#333; border:0; border-radius: 999px; width:36px; height:36px; cursor:pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
  </style>

  <!-- Checkout Modal -->
  <div id="checkoutOverlay" class="cb-modal-overlay" aria-hidden="true">
    <div class="cb-modal" role="dialog" aria-labelledby="cbCheckoutTitle" aria-modal="true" style="max-width:720px;">
      <div class="cb-modal-grid" style="min-height: 0;">
        <div class="cb-modal-body" style="flex: 1 1 100%; background: #fff; color:#333;">
          <div style="font-family:'Bangers', Impact, Charcoal, sans-serif; font-size:36px; color:#d92626; text-shadow:1px 1px #000;">CARD BAZAAR</div>
          <h3 id="cbCheckoutTitle" style="color:#111;">Checkout</h3>
          <div id="checkoutSummary" style="margin-bottom:12px; font-size:16px; color:#333;"></div>
          <label style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
            <input type="checkbox" id="applyStoreCredit"> Apply store credit
            <span id="availableCredit" style="color:#d92626; font-weight:700;"></span>
          </label>
          <div class="cb-modal-actions">
            <button id="checkoutPlaceBtn" class="cb-btn-primary">Place Order</button>
            <button id="checkoutCancelBtn" class="cb-btn-secondary">Cancel</button>
          </div>
          <div class="cb-footnote" style="color:#555;">Simulated checkout for prototype. No payment is processed.</div>
        </div>
      </div>
    </div>
  </div>
  <!-- High-Res Image Overlay -->
  <div id="hiresOverlay" class="img-overlay" aria-hidden="true">
    <div class="img-modal">
      <button id="hiresClose" class="img-close" aria-label="Close">✕</button>
      <img id="hiresImage" alt="High-resolution card scan">
    </div>
  </div>
  <div id="sellInfoPopup" style="display:none; position:fixed; top:96px; right:24px; background:#fff; color:#333; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.25); width:360px; padding:16px; z-index:1400;">
    Looking to sell us your cards? Our team of Graders will verify the condition of each card and give you the highest market rate out of any other retailer for your NM editions. Coming soon!
  </div>
  <!-- Email Capture Modal (injected content target) -->
  <div id="cbEmailOverlay" class="cb-modal-overlay" aria-hidden="true">
    <div class="cb-modal" role="dialog" aria-labelledby="cbEmailTitle" aria-modal="true">
      <div class="cb-modal-grid">
        <div class="cb-modal-img">
          <div class="cb-card-frame">
            <div class="cb-card-stack" id="cbModalStack"></div>
          </div>
        </div>
        <div class="cb-modal-body">
          <div class="cb-brand">CARD BAZAAR</div>
          <h3 id="cbEmailTitle">Join the waitlist</h3>
          <p>Be first to know about card drops, promos, and new features.</p>
          <input type="email" id="cbEmailInput" class="cb-input" placeholder="Best Email" aria-label="Email address">
          <div class="cb-modal-actions">
            <button id="cbEmailSubmit" class="cb-btn-primary">CONTINUE</button>
            <button id="cbEmailDismiss" class="cb-btn-secondary">No thanks</button>
          </div>
          <div class="cb-footnote">We’ll send occasional updates. Unsubscribe anytime.</div>
          <div id="cbEmailMessage" style="margin-top:10px;font-size:14px;color:#a5d6a7;display:none;"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Daily Spin Modal -->
  <div id="cbWheelOverlay" class="cb-wheel-overlay" aria-hidden="true">
    <div class="cb-wheel-modal" role="dialog" aria-labelledby="cbWheelTitle" aria-modal="true">
      <div class="cb-wheel-grid">
        <div class="cb-wheel-left">
          <div class="cb-wheel-container">
            <div class="cb-pointer"></div>
            <div id="cbWheel" class="cb-wheel"></div>
          </div>
        </div>
        <div class="cb-wheel-right">
          <div class="cb-wheel-brand">CARD BAZAAR</div>
          <div id="cbWheelTitle" class="cb-wheel-title">Spin the wheel</div>
          <div class="cb-wheel-legend">Possible rewards: $10 store credit, free shipping, Card Bazaar points, a free card.</div>
          <div class="cb-wheel-controls">
            <button id="cbWheelSpin" class="cb-btn-primary">SPIN</button>
            <button id="cbWheelDismiss" class="cb-btn-secondary">Not now</button>
          </div>
          <div id="cbWheelResult" class="cb-result"></div>
        </div>
      </div>
    </div>
  </div>
    <script src="fetchCardImages.js"></script>
    <script src="app.js"></script>
    <script>
      fetchCardImages();
    </script>
</body>
</html>

